(function($){if(!Function.prototype.bind){(function(){var slice=Array.prototype.slice;function update(array,args){var arrayLength=array.length,length=args.length;while(length--)array[arrayLength+length]=args[length];return array;};function merge(array,args){array=slice.call(array,0);return update(array,args);};Function.prototype.bind=function(context){if(arguments.length<2&&arguments[0]==undefined)return this;var __method=this,args=slice.call(arguments,1);return function(){var a=merge(args,arguments);return __method.apply(context,a);}};Function.prototype.bindEV=function(context){var __method=this,args=slice.call(arguments,1);return function(event){var a=update([event||window.event],args);return __method.apply(context,a);}};})();}function Banner(el,opts){this.init(el,opts)}Banner.prototype={init:function(el,opts){this.element=el;this.options=opts;this.length=$("ul.banners li",this.element).length;this.width=$("ul.banners li img",this.element).width();this.current_index=0;this._stop=false;this.setup();},setup:function(){var selected=0;$("ul.dots li",this.element).each(function(){if($(this).hasClass("selected")){return false;}selected++;});this.current_index=selected;$("ul.banners li",this.element).css({margin:0,padding:0,opacity:0});$("ul.banners",this.element).css({position:'relative'});$("ul.banners li:nth-child("+(this.current_index+1)+")",this.element).css({opacity:1});$("ul.banners",this.element).width(this.length*$("ul.banners li img",this.element).width());$("ul.banners",this.element).height($("ul.banners li img",this.element).height());$("ul.banners li",this.element).width(this.width);var width=this.width;var original_order=[];$("ul.banners li",this.element).each(function(i){var left=(i*width);$(this).css({position:'absolute',left:left+'px',top:0});original_order.push({left:left,element:this});});this.original_order=original_order;$(this.element).width(this.width);$(this.element).height($("ul.banners li img",this.element).height());$(this.element).css({overflow:'hidden'});var self=this;$("ul.dots li a",this.element).click(function(e){e.preventDefault();self.clickJump(this);});this.autoFlip();},stage:function(){$("ul.banners li:nth-child("+(this.current_index+1)+")").css({left:this.width+'px'});},restore:function(){},nextHandler:function(cb){if(cb){if(this.nextClick!=null&&this.nextClick!=undefined){var next=this.nextClick;this.nextClick=null;this.flip(next);}else{cb();}}},reposition:function(cb){if(!this.animating_current&&!this.animating_next){var width=this.width;var total=this.length;this.reshift((this.current_index+1)>=this.length?0:(this.current_index+1));this.nextHandler(cb);}},reshift:function(next_index){var current=$("ul.banners li:nth-child("+(this.current_index+1)+")",this.element);var next=$("ul.banners li:nth-child("+(next_index+1)+")",this.element);if(parseInt(next.css("left"))!=this.width){var width=this.width;var total=this.length;var current_index=this.current_index;$("ul.banners li").css({left:0,opacity:0});$("ul.banners li:nth-child("+(next_index+1)+")",this.element).css({left:width});$("ul.banners li:nth-child("+(current_index+1)+")",this.element).css({left:0,opacity:1});$("ul.banners li").each(function(index,item){if(index!=current_index&&index!=next_index){$(this).css({left:(width+(index*width))});}});}},flip:function(index,cb){if(index!=undefined){var next_index=index;}else{var next_index=this.current_index+1;}if(next_index>=this.length){next_index=0;}if(next_index==this.current_index){return;}this.reshift(next_index);$("ul.dots li.selected").removeClass("selected");$("ul.dots li:nth-child("+(next_index+1)+")").addClass("selected");var current=$("ul.banners li:nth-child("+(this.current_index+1)+")",this.element);var next=$("ul.banners li:nth-child("+(next_index+1)+")",this.element);this.animating_current=true;current.animate({left:-1*this.width,opacity:0},{duration:this.options.rotation_duration,complete:function(){this.current_index=next_index;this.animating_current=false;this.reposition(cb);}.bind(this)});this.animating_next=true;next.animate({left:0,opacity:1},{duration:this.options.rotation_duration,complete:function(){this.current_index=next_index;this.animating_next=false;this.reposition(cb);}.bind(this)});},autoFlip:function(){if(this._stop){return;}this.pause();this.autoTimer=setTimeout(function(){this.flip(undefined,this.autoFlip.bind(this));}.bind(this),this.options.rotation_delay);},pause:function(){if(this.autoTimer){clearTimeout(this.autoTimer);this.autoTimer=null;}},stop:function(){this.pause();this._stop=true;},clickJump:function(dot){this.stop();var clicked=parseInt($(dot).attr("href").replace(/#/,''))-1;if(!this.animating_current&&!this.animating_next){this.flip(clicked);}else{this.nextClick=clicked;}}};$.fn.extend({dl:function(options){var defaults={rotation_delay:5000,rotation_duration:2250};var options=$.extend(defaults,options);return this.each(function(){new Banner(this,options);});}});})(jQuery);
